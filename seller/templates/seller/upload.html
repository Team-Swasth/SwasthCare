{% extends 'base.html' %}

{% block title %}SwasthCare - Upload Product Images{% endblock %}

{% block content %}
<div class="upload-container">
    <div class="header-section">
        <h2 class="page-title">
            <i class="bi bi-cloud-upload"></i>
            Upload Product Images
        </h2>
        <p class="page-subtitle">Capture or upload product images for AI-powered analysis</p>
    </div>

    <div class="upload-card">
        <div class="upload-instruction">
            <i class="bi bi-lightbulb"></i>
            <h4>Tips for Best Results</h4>
            <ul>
                <li>Ensure good lighting and clear images</li>
                <li>Capture all sides of the product</li>
                <li>Focus on nutrition labels and ingredients</li>
                <li>Use camera or upload from device</li>
            </ul>
        </div>

        <form method="post" enctype="multipart/form-data" class="upload-form">
            {% csrf_token %}

            <div class="upload-grid">
                <div class="upload-item" data-type="front">
                    <div class="upload-content">
                        <i class="bi bi-image"></i>
                        <h5>Product Front</h5>
                        <p>Main product image</p>
                        <div class="upload-actions">
                            <button type="button" class="btn btn-outline-primary btn-sm camera-btn"
                                data-target="id_document1">
                                <i class="bi bi-camera"></i> Take Photo
                            </button>
                            <span class="or-text">or</span>
                            <label for="id_document1" class="btn btn-primary btn-sm">
                                <i class="bi bi-upload"></i> Upload
                            </label>
                            <input type="file" id="id_document1" name="document1" accept="image/*" hidden>
                        </div>
                    </div>
                    <div class="preview-container" id="preview1">
                        <div class="preview-placeholder">
                            <i class="bi bi-image"></i>
                        </div>
                    </div>
                </div>

                <div class="upload-item" data-type="nutrition">
                    <div class="upload-content">
                        <i class="bi bi-list-ul"></i>
                        <h5>Nutrition Label</h5>
                        <p>Nutritional information</p>
                        <div class="upload-actions">
                            <button type="button" class="btn btn-outline-primary btn-sm camera-btn"
                                data-target="id_document2">
                                <i class="bi bi-camera"></i> Take Photo
                            </button>
                            <span class="or-text">or</span>
                            <label for="id_document2" class="btn btn-primary btn-sm">
                                <i class="bi bi-upload"></i> Upload
                            </label>
                            <input type="file" id="id_document2" name="document2" accept="image/*" hidden>
                        </div>
                    </div>
                    <div class="preview-container" id="preview2">
                        <div class="preview-placeholder">
                            <i class="bi bi-list-ul"></i>
                        </div>
                    </div>
                </div>

                <div class="upload-item" data-type="ingredients">
                    <div class="upload-content">
                        <i class="bi bi-text-paragraph"></i>
                        <h5>Ingredients List</h5>
                        <p>Complete ingredients</p>
                        <div class="upload-actions">
                            <button type="button" class="btn btn-outline-primary btn-sm camera-btn"
                                data-target="id_document3">
                                <i class="bi bi-camera"></i> Take Photo
                            </button>
                            <span class="or-text">or</span>
                            <label for="id_document3" class="btn btn-primary btn-sm">
                                <i class="bi bi-upload"></i> Upload
                            </label>
                            <input type="file" id="id_document3" name="document3" accept="image/*" hidden>
                        </div>
                    </div>
                    <div class="preview-container" id="preview3">
                        <div class="preview-placeholder">
                            <i class="bi bi-text-paragraph"></i>
                        </div>
                    </div>
                </div>

                <div class="upload-item" data-type="barcode">
                    <div class="upload-content">
                        <i class="bi bi-upc-scan"></i>
                        <h5>Barcode</h5>
                        <p>Product barcode</p>
                        <div class="upload-actions">
                            <button type="button" class="btn btn-outline-primary btn-sm camera-btn"
                                data-target="id_document4">
                                <i class="bi bi-camera"></i> Take Photo
                            </button>
                            <span class="or-text">or</span>
                            <label for="id_document4" class="btn btn-primary btn-sm">
                                <i class="bi bi-upload"></i> Upload
                            </label>
                            <input type="file" id="id_document4" name="document4" accept="image/*" hidden>
                        </div>
                    </div>
                    <div class="preview-container" id="preview4">
                        <div class="preview-placeholder">
                            <i class="bi bi-upc-scan"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="submit-section">
                <button type="submit" class="btn btn-success btn-lg submit-btn">
                    <i class="bi bi-cpu"></i>
                    <span>Process with AI</span>
                    <div class="btn-shine"></div>
                </button>
                <p class="process-note">Our AI will analyze your images and extract product information automatically
                </p>
            </div>
        </form>
    </div>
</div>

<!-- Camera Modal -->
<div class="modal fade" id="cameraModal" tabindex="-1" aria-labelledby="cameraModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="cameraModalLabel">
                    <i class="bi bi-camera"></i> Take Product Photo
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="cameraStatus" class="camera-status mb-3"></div>
                <div class="camera-container">
                    <video id="cameraVideo" autoplay playsinline muted></video>
                    <canvas id="cameraCanvas" style="display: none;"></canvas>
                    <div class="camera-overlay">
                        <div class="camera-guide">
                            <div class="guide-corner top-left"></div>
                            <div class="guide-corner top-right"></div>
                            <div class="guide-corner bottom-left"></div>
                            <div class="guide-corner bottom-right"></div>
                            <p class="guide-text">Position product within the frame</p>
                        </div>
                    </div>
                </div>
                <div class="camera-controls">
                    <button type="button" class="btn btn-primary btn-lg" id="captureBtn">
                        <i class="bi bi-camera"></i> Capture Photo
                    </button>
                    <button type="button" class="btn btn-warning btn-lg" id="retakeBtn" style="display: none;">
                        <i class="bi bi-arrow-counterclockwise"></i> Retake
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle"></i> Cancel
                </button>
                <button type="button" class="btn btn-success btn-lg" id="usePhotoBtn" style="display: none;">
                    <i class="bi bi-check-circle"></i> Use This Photo
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}


{% block extra_css %}
<style>
    .upload-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
    }

    .header-section {
        text-align: center;
        margin-bottom: 3rem;
    }

    .page-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 1rem;
    }

    .page-subtitle {
        font-size: 1.2rem;
        color: var(--text-secondary);
        margin-bottom: 0;
    }

    .upload-card {
        background: var(--card-bg);
        border-radius: 20px;
        padding: 2rem;
        box-shadow: var(--card-shadow);
        border: 1px solid var(--border-color);
    }

    .upload-instruction {
        background: linear-gradient(135deg, var(--primary-light), var(--primary-color));
        color: white;
        padding: 1.5rem;
        border-radius: 15px;
        margin-bottom: 2rem;
        text-align: center;
    }

    .upload-instruction i {
        font-size: 2rem;
        margin-bottom: 1rem;
    }

    .upload-instruction h4 {
        margin-bottom: 1rem;
        font-weight: 600;
    }

    .upload-instruction ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .upload-instruction li {
        margin-bottom: 0.5rem;
        position: relative;
        padding-left: 1.5rem;
    }

    .upload-instruction li:before {
        content: "✓";
        position: absolute;
        left: 0;
        color: rgba(255, 255, 255, 0.9);
        font-weight: bold;
    }

    .upload-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
    }

    .upload-item {
        background: var(--card-bg);
        border: 2px dashed var(--border-color);
        border-radius: 15px;
        padding: 1.5rem;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .upload-item:hover {
        border-color: var(--primary-color);
        background: rgba(76, 175, 80, 0.05);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }

    .upload-item.has-image {
        border-color: var(--success-color);
        background: rgba(76, 175, 80, 0.1);
    }

    .upload-content {
        text-align: center;
        margin-bottom: 1rem;
    }

    .upload-content i {
        font-size: 3rem;
        color: var(--primary-color);
        margin-bottom: 1rem;
    }

    .upload-content h5 {
        font-weight: 600;
        color: var(--text-color);
        margin-bottom: 0.5rem;
    }

    .upload-content p {
        color: var(--text-secondary);
        margin-bottom: 1rem;
    }

    .upload-actions {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
    }

    .or-text {
        font-size: 0.9rem;
        color: var(--text-secondary);
    }

    .camera-btn,
    .upload-btn {
        min-width: 120px;
    }

    .preview-container {
        border-radius: 10px;
        overflow: hidden;
        min-height: 150px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--background-color);
        border: 1px solid var(--border-color);
    }

    .preview-placeholder {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
        color: var(--text-secondary);
    }

    .preview-placeholder i {
        font-size: 3rem;
        opacity: 0.5;
    }

    .preview-container img {
        max-width: 100%;
        max-height: 200px;
        object-fit: contain;
        border-radius: 10px;
    }

    .submit-section {
        text-align: center;
        margin-top: 3rem;
    }

    .submit-btn {
        position: relative;
        overflow: hidden;
        padding: 1rem 3rem;
        font-size: 1.2rem;
        font-weight: 600;
        border-radius: 50px;
        background: linear-gradient(135deg, var(--success-color), var(--primary-color));
        border: none;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .submit-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(76, 175, 80, 0.4);
    }

    .submit-btn:active {
        transform: translateY(-1px);
    }

    .btn-shine {
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        transition: left 0.5s;
    }

    .submit-btn:hover .btn-shine {
        left: 100%;
    }

    .process-note {
        margin-top: 1rem;
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    /* Camera Modal Styles */
    .camera-status {
        padding: 1rem;
        border-radius: 8px;
        text-align: center;
        font-weight: 500;
    }

    .camera-status.success {
        background: rgba(40, 167, 69, 0.1);
        color: #28a745;
        border: 1px solid rgba(40, 167, 69, 0.3);
    }

    .camera-status.error {
        background: rgba(220, 53, 69, 0.1);
        color: #dc3545;
        border: 1px solid rgba(220, 53, 69, 0.3);
    }

    .camera-status.info {
        background: rgba(13, 110, 253, 0.1);
        color: #0d6efd;
        border: 1px solid rgba(13, 110, 253, 0.3);
    }

    .camera-container {
        position: relative;
        background: #000;
        border-radius: 15px;
        overflow: hidden;
        margin-bottom: 1rem;
        min-height: 500px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .camera-container video {
        width: 100%;
        height: 500px;
        object-fit: cover;
        border-radius: 15px;
    }

    .camera-container canvas {
        width: 100%;
        height: 500px;
        object-fit: cover;
        border-radius: 15px;
    }

    .camera-controls {
        display: flex;
        gap: 1rem;
        justify-content: center;
        align-items: center;
        margin-top: 1rem;
    }

    .camera-controls .btn {
        min-width: 150px;
        border-radius: 50px;
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .camera-controls .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    /* Loading states */
    .submit-btn.processing {
        background: linear-gradient(135deg, #ffa726, #ff9800);
        cursor: not-allowed;
    }

    .submit-btn.processing i {
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    /* Responsive design */
    @media (max-width: 768px) {
        .upload-container {
            padding: 1rem;
        }

        .page-title {
            font-size: 2rem;
        }

        .upload-grid {
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .upload-item {
            padding: 1rem;
        }

        .submit-btn {
            padding: 0.8rem 2rem;
            font-size: 1rem;
        }
    }

    /* Dark mode specific styles */
    [data-theme="dark"] .upload-item {
        background: var(--card-bg);
        border-color: var(--border-color);
    }

    [data-theme="dark"] .upload-item:hover {
        background: rgba(76, 175, 80, 0.1);
    }

    [data-theme="dark"] .preview-container {
        background: var(--background-color);
        border-color: var(--border-color);
    }

    [data-theme="dark"] .camera-container {
        background: #000;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        let currentTargetInput = null;
        let stream = null;
        let capturedImageData = null;

        // Camera functionality
        const cameraModal = new bootstrap.Modal(document.getElementById('cameraModal'));
        const video = document.getElementById('cameraVideo');
        const canvas = document.getElementById('cameraCanvas');
        const captureBtn = document.getElementById('captureBtn');
        const retakeBtn = document.getElementById('retakeBtn');
        const usePhotoBtn = document.getElementById('usePhotoBtn');

        // Camera button event listeners
        document.querySelectorAll('.camera-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                currentTargetInput = document.getElementById(this.dataset.target);
                startCamera();
                cameraModal.show();
            });
        });

        // File input change listeners
        document.querySelectorAll('input[type="file"]').forEach(input => {
            input.addEventListener('change', function () {
                previewImage(this);
            });
        });

        // Camera functions
        async function startCamera() {
            try {
                // Request camera permission explicitly
                await navigator.mediaDevices.getUserMedia({ video: true });

                // Now get the actual stream with better constraints
                stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'environment',
                        width: { ideal: 1280, max: 1920 },
                        height: { ideal: 720, max: 1080 }
                    }
                });
                video.srcObject = stream;
                video.style.display = 'block';
                canvas.style.display = 'none';
                captureBtn.style.display = 'block';
                retakeBtn.style.display = 'none';
                usePhotoBtn.style.display = 'none';

                // Show success message
                document.getElementById('cameraStatus').innerHTML =
                    '<div class="alert alert-success"><i class="bi bi-check-circle"></i> Camera ready! Position your product and click capture.</div>';
            } catch (error) {
                console.error('Error accessing camera:', error);
                let errorMessage = 'Unable to access camera. ';

                if (error.name === 'NotAllowedError') {
                    errorMessage += 'Please allow camera permissions and try again.';
                } else if (error.name === 'NotFoundError') {
                    errorMessage += 'No camera found on this device.';
                } else if (error.name === 'NotSupportedError') {
                    errorMessage += 'Camera not supported on this browser.';
                } else {
                    errorMessage += 'Please check camera permissions and try again.';
                }

                document.getElementById('cameraStatus').innerHTML =
                    `<div class="alert alert-danger"><i class="bi bi-exclamation-triangle"></i> ${errorMessage}</div>`;
            }
        }

        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
        }

        captureBtn.addEventListener('click', function () {
            const context = canvas.getContext('2d');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0);

            video.style.display = 'none';
            canvas.style.display = 'block';
            captureBtn.style.display = 'none';
            retakeBtn.style.display = 'block';
            usePhotoBtn.style.display = 'block';

            capturedImageData = canvas.toDataURL('image/jpeg', 0.8);
        });

        retakeBtn.addEventListener('click', function () {
            video.style.display = 'block';
            canvas.style.display = 'none';
            captureBtn.style.display = 'block';
            retakeBtn.style.display = 'none';
            usePhotoBtn.style.display = 'none';
            capturedImageData = null;
        });

        usePhotoBtn.addEventListener('click', function () {
            if (capturedImageData && currentTargetInput) {
                // Convert dataURL to file
                const blob = dataURLtoBlob(capturedImageData);
                const file = new File([blob], 'camera-capture.jpg', { type: 'image/jpeg' });

                // Create a new FileList
                const dt = new DataTransfer();
                dt.items.add(file);
                currentTargetInput.files = dt.files;

                // Preview the image
                previewImage(currentTargetInput);

                // Close modal
                cameraModal.hide();
                stopCamera();
            }
        });

        // Modal event listeners
        document.getElementById('cameraModal').addEventListener('hidden.bs.modal', function () {
            stopCamera();
            currentTargetInput = null;
            capturedImageData = null;
        });

        // Attach event to the close button to stop camera immediately
        document.querySelector('#cameraModal .btn-close').addEventListener('click', function () {
            stopCamera();
            // Also clear the video source immediately
            video.srcObject = null;
        });

        // Image preview function
        function previewImage(input) {
            const previewId = 'preview' + input.id.replace('id_document', '');
            const previewContainer = document.getElementById(previewId);
            const uploadItem = input.closest('.upload-item');

            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    previewContainer.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
                    uploadItem.classList.add('has-image');

                    // Add success animation
                    uploadItem.style.animation = 'none';
                    uploadItem.offsetHeight; // Trigger reflow
                    uploadItem.style.animation = 'successPulse 0.6s ease-out';
                };
                reader.readAsDataURL(input.files[0]);
            } else {
                // Reset preview
                const iconClass = getIconClass(previewId);
                previewContainer.innerHTML = `<div class="preview-placeholder"><i class="${iconClass}"></i></div>`;
                uploadItem.classList.remove('has-image');
            }
        }

        // Helper function to get appropriate icon
        function getIconClass(previewId) {
            const icons = {
                'preview1': 'bi bi-image',
                'preview2': 'bi bi-list-ul',
                'preview3': 'bi bi-text-paragraph',
                'preview4': 'bi bi-upc-scan'
            };
            return icons[previewId] || 'bi bi-image';
        }

        // Helper function to convert dataURL to blob
        function dataURLtoBlob(dataURL) {
            const arr = dataURL.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            while (n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new Blob([u8arr], { type: mime });
        }

        // Form submission handling
        document.querySelector('.upload-form').addEventListener('submit', function (e) {
            const submitBtn = document.querySelector('.submit-btn');
            const hasImages = document.querySelectorAll('.upload-item.has-image').length > 0;

            if (!hasImages) {
                e.preventDefault();
                alert('Please upload at least one image before processing.');
                return;
            }

            // Add loading state
            submitBtn.classList.add('processing');
            submitBtn.innerHTML = '<i class="bi bi-cpu"></i><span>Processing...</span>';
            submitBtn.disabled = true;
        });

        // CSS animation injection remains
        const style = document.createElement('style');
        style.textContent = `
            @keyframes successPulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); }
                100% { transform: scale(1); }
            }
        `;
        document.head.appendChild(style);
    });
</script>
{% endblock %}

.navbar {
background-color: var(--white);
box-shadow: var(--shadow-sm);
padding: 1rem 1.5rem;
display: flex;
justify-content: space-between;
align-items: center;
}

.logo {
font-size: 1.5rem;
font-weight: 700;
color: var(--primary);
display: flex;
align-items: center;
gap: 0.5rem;
}

.logo-icon {
color: var(--primary);
font-size: 1.8rem;
}

.container {
max-width: 1200px;
margin: 0 auto;
padding: 2rem 1.5rem;
flex: 1;
width: 100%;
}

.card {
background: var(--white);
border-radius: 12px;
box-shadow: var(--shadow-md);
overflow: hidden;
transition: all 0.3s ease;
max-width: 600px;
margin: 2rem auto;
}

.card-header {
background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
padding: 1.5rem 2rem;
color: white;
}

.card-title {
font-size: 1.5rem;
font-weight: 600;
margin-bottom: 0.5rem;
}

.card-subtitle {
font-size: 1rem;
opacity: 0.9;
}

.card-body {
padding: 2rem;
}

.upload-area {
margin-bottom: 1.5rem;
}

.upload-instruction {
text-align: center;
margin-bottom: 1.5rem;
padding: 1rem;
background: rgba(8, 156, 123, 0.08);
border-radius: 8px;
border: 1px dashed var(--primary);
}

.upload-instruction p {
color: var(--primary);
font-weight: 500;
}

.upload-instruction svg {
margin-bottom: 0.5rem;
color: var(--primary);
}

.upload-grid {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 1rem;
margin-bottom: 1.5rem;
}

.upload-item {
position: relative;
background: var(--lighter-gray);
border-radius: 8px;
padding: 1rem;
border: 2px dashed var(--light-gray);
transition: all 0.2s ease;
height: 120px;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
cursor: pointer;
}

.upload-item:hover {
border-color: var(--primary);
background: rgba(8, 156, 123, 0.05);
}

.upload-item input[type="file"] {
position: absolute;
width: 100%;
height: 100%;
top: 0;
left: 0;
opacity: 0;
cursor: pointer;
}

.upload-icon {
font-size: 1.5rem;
color: var(--gray);
margin-bottom: 0.5rem;
}

.upload-label {
font-size: 0.875rem;
color: var(--gray);
text-align: center;
}

.help-text {
color: var(--gray);
font-size: 0.875rem;
margin-bottom: 1.5rem;
line-height: 1.5;
}

.btn {
display: inline-block;
padding: 0.75rem 1.5rem;
font-weight: 500;
font-size: 1rem;
text-align: center;
border-radius: 8px;
border: none;
cursor: pointer;
transition: all 0.2s ease;
text-decoration: none;
}

.btn-primary {
background: var(--primary);
color: white;
box-shadow: 0 2px 4px rgba(8, 156, 123, 0.2);
}

.btn-primary:hover {
background: var(--primary-dark);
transform: translateY(-2px);
box-shadow: 0 4px 8px rgba(8, 156, 123, 0.3);
}

.btn-block {
display: block;
width: 100%;
}

.footer {
background: var(--white);
text-align: center;
padding: 1.5rem;
color: var(--gray);
font-size: 0.875rem;
margin-top: auto;
}

.upload-preview {
width: 100%;
height: 100%;
object-fit: cover;
border-radius: 6px;
display: none;
}

@keyframes pulse {
0% {
box-shadow: 0 0 0 0 rgba(8, 156, 123, 0.4);
}
70% {
box-shadow: 0 0 0 10px rgba(8, 156, 123, 0);
}
100% {
box-shadow: 0 0 0 0 rgba(8, 156, 123, 0);
}
}

.pulse {
animation: pulse 1.5s infinite;
}
</style>
</head>

<body>
    <nav class="navbar" style="position: sticky; top: 0; z-index: 1000;">
        <div class="logo">
            <svg class="logo-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M19.5 12.572l-7.5 7.428l-7.5 -7.428a5 5 0 1 1 7.5 -6.566a5 5 0 1 1 7.5 6.572"></path>
            </svg>
            SwasthCare
        </div>
        <div class="nav-links">
            <!-- Navigation links can be added here -->
        </div>
    </nav>

    <div class="container">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Product Document Upload</h2>
                <p class="card-subtitle">Upload packaging images for automated data extraction</p>
            </div>
            <div class="card-body">
                <div class="upload-instruction">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    <p>Upload clear images of product packaging for best results</p>
                </div>

                <form method="post" enctype="multipart/form-data" id="uploadForm">
                    {% csrf_token %}
                    <div class="upload-grid">
                        <div class="upload-item" id="upload1">
                            <svg class="upload-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <polyline points="21 15 16 10 5 21"></polyline>
                            </svg>
                            <span class="upload-label">Front Image</span>
                            {{ form.document1 }}
                            <img id="preview1" class="upload-preview">
                        </div>
                        <div class="upload-item" id="upload2">
                            <svg class="upload-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <polyline points="21 15 16 10 5 21"></polyline>
                            </svg>
                            <span class="upload-label">Back Image</span>
                            {{ form.document2 }}
                            <img id="preview2" class="upload-preview">
                        </div>
                        <div class="upload-item" id="upload3">
                            <svg class="upload-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <polyline points="21 15 16 10 5 21"></polyline>
                            </svg>
                            <span class="upload-label">Nutrition Facts</span>
                            {{ form.document3 }}
                            <img id="preview3" class="upload-preview">
                        </div>
                        <div class="upload-item" id="upload4">
                            <svg class="upload-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <polyline points="21 15 16 10 5 21"></polyline>
                            </svg>
                            <span class="upload-label">Additional Image</span>
                            {{ form.document4 }}
                            <img id="preview4" class="upload-preview">
                        </div>
                    </div>

                    <p class="help-text">Upload up to 4 high-quality images of your product packaging. Our AI will
                        extract product details automatically. For best results, ensure images are clear and well-lit.
                    </p>
                    <button type="submit" class="btn btn-primary btn-block" id="processBtn">Process Images</button>
                </form>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>© 2025 SwasthCare. All rights reserved.</p>
    </footer>

    <script>
        // Preview uploaded images
        function previewImage(input, previewId) {
            const preview = document.getElementById(previewId);
            const uploadItem = document.getElementById(input.id.replace('id_document', 'upload'));

            if (input.files && input.files[0]) {
                const reader = new FileReader();

                reader.onload = function (e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    uploadItem.querySelector('.upload-icon').style.display = 'none';
                    uploadItem.querySelector('.upload-label').style.display = 'none';
                }

                reader.readAsDataURL(input.files[0]);
            } else {
                preview.style.display = 'none';
                uploadItem.querySelector('.upload-icon').style.display = 'block';
                uploadItem.querySelector('.upload-label').style.display = 'block';
            }
        }

        // Setup image preview for all upload fields
        document.getElementById('id_document1').addEventListener('change', function () {
            previewImage(this, 'preview1');
        });

        document.getElementById('id_document2').addEventListener('change', function () {
            previewImage(this, 'preview2');
        });

        document.getElementById('id_document3').addEventListener('change', function () {
            previewImage(this, 'preview3');
        });

        document.getElementById('id_document4').addEventListener('change', function () {
            previewImage(this, 'preview4');
        });

        // Add loading animation on form submit
        document.getElementById('uploadForm').addEventListener('submit', function () {
            const btn = document.getElementById('processBtn');
            btn.innerHTML = '<span>Processing...</span>';
            btn.disabled = true;
            btn.classList.add('pulse');
        });
    </script>
</body>

</html>