{% extends 'base.html' %}

{% block title %}SwasthCare - Product Document Upload{% endblock %}

{% block content %}
<div class="upload-page-container">
    <div class="upload-header text-center mb-5">
        <h1 class="display-5 gradient-text">Product Document Upload</h1>
        <p class="lead text-muted">Upload packaging images for automated data extraction</p>
        <div class="upload-progress-indicator">
            <div class="upload-hint">
                <i class="bi bi-info-circle text-primary"></i>
                <span>Upload up to 4 high-quality images of your product packaging</span>
            </div>
        </div>
    </div>

    <form method="post" enctype="multipart/form-data" class="upload-form">
        {% csrf_token %}

        <div class="upload-grid-2x2">
            <!-- Front Image -->
            <div class="upload-card" data-type="front">
                <div class="upload-card-header">
                    <i class="bi bi-box-seam text-primary"></i>
                    <h5>Front Image</h5>
                </div>
                <div class="upload-dropzone" onclick="document.getElementById('id_document1').click()">
                    <div class="preview-container" id="preview1">
                        <div class="preview-placeholder">
                            <i class="bi bi-image"></i>
                            <p>Click or drag image here</p>
                        </div>
                    </div>
                </div>
                <div class="upload-actions">
                    <button type="button" class="btn btn-outline-primary btn-sm camera-btn" data-target="id_document1">
                        <i class="bi bi-camera"></i>
                    </button>
                    <input type="file" id="id_document1" name="document1" accept="image/*" hidden>
                </div>
            </div>

            <!-- Back Image -->
            <div class="upload-card" data-type="back">
                <div class="upload-card-header">
                    <i class="bi bi-box-seam-fill text-primary"></i>
                    <h5>Back Image</h5>
                </div>
                <div class="upload-dropzone" onclick="document.getElementById('id_document2').click()">
                    <div class="preview-container" id="preview2">
                        <div class="preview-placeholder">
                            <i class="bi bi-image"></i>
                            <p>Click or drag image here</p>
                        </div>
                    </div>
                </div>
                <div class="upload-actions">
                    <button type="button" class="btn btn-outline-primary btn-sm camera-btn" data-target="id_document2">
                        <i class="bi bi-camera"></i>
                    </button>
                    <input type="file" id="id_document2" name="document2" accept="image/*" hidden>
                </div>
            </div>

            <!-- Nutrition Facts -->
            <div class="upload-card" data-type="nutrition">
                <div class="upload-card-header">
                    <i class="bi bi-card-checklist text-primary"></i>
                    <h5>Nutrition Facts</h5>
                </div>
                <div class="upload-dropzone" onclick="document.getElementById('id_document3').click()">
                    <div class="preview-container" id="preview3">
                        <div class="preview-placeholder">
                            <i class="bi bi-image"></i>
                            <p>Click or drag image here</p>
                        </div>
                    </div>
                </div>
                <div class="upload-actions">
                    <button type="button" class="btn btn-outline-primary btn-sm camera-btn" data-target="id_document3">
                        <i class="bi bi-camera"></i>
                    </button>
                    <input type="file" id="id_document3" name="document3" accept="image/*" hidden>
                </div>
            </div>

            <!-- Additional Image -->
            <div class="upload-card" data-type="additional">
                <div class="upload-card-header">
                    <i class="bi bi-plus-circle text-primary"></i>
                    <h5>Additional Image</h5>
                </div>
                <div class="upload-dropzone" onclick="document.getElementById('id_document4').click()">
                    <div class="preview-container" id="preview4">
                        <div class="preview-placeholder">
                            <i class="bi bi-image"></i>
                            <p>Click or drag image here</p>
                        </div>
                    </div>
                </div>
                <div class="upload-actions">
                    <button type="button" class="btn btn-outline-primary btn-sm camera-btn" data-target="id_document4">
                        <i class="bi bi-camera"></i>
                    </button>
                    <input type="file" id="id_document4" name="document4" accept="image/*" hidden>
                </div>
            </div>
        </div>

        <!-- Animated Submit Button -->
        <div class="submit-section">
            <button type="submit" class="btn-submit-animated" id="submitBtn">
                <div class="btn-content">
                    <i class="bi bi-cloud-upload-fill"></i>
                    <span>Process Images</span>
                </div>
                <div class="btn-overlay"></div>
                <div class="btn-particles"></div>
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .upload-page-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
    }

    .upload-header {
        background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(255, 152, 0, 0.1));
        border-radius: 20px;
        padding: 3rem 2rem;
        margin-bottom: 3rem;
    }

    .gradient-text {
        background: linear-gradient(135deg, #4CAF50, #FF9800);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 700;
    }

    .upload-progress-indicator {
        display: flex;
        justify-content: center;
        margin-top: 1.5rem;
    }

    .upload-hint {
        background: rgba(255, 255, 255, 0.9);
        padding: 1rem 2rem;
        border-radius: 50px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 500;
    }

    .upload-grid-2x2 {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 2rem;
        margin-bottom: 3rem;
    }

    .upload-card {
        background: white;
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
        border: 2px solid transparent;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .upload-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        border-color: #4CAF50;
    }

    .upload-card-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1.5rem;
        color: #4CAF50;
    }

    .upload-card-header i {
        font-size: 1.5rem;
    }

    .upload-card-header h5 {
        margin: 0;
        font-weight: 600;
        color: #333;
    }

    .upload-dropzone {
        border: 2px dashed #ddd;
        border-radius: 15px;
        padding: 2rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-bottom: 1rem;
        min-height: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .upload-dropzone:hover {
        border-color: #4CAF50;
        background: rgba(76, 175, 80, 0.05);
    }

    .preview-container {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .preview-placeholder {
        text-align: center;
        color: #999;
    }

    .preview-placeholder i {
        font-size: 3rem;
        margin-bottom: 1rem;
        color: #ddd;
    }

    .preview-placeholder p {
        margin: 0;
        font-weight: 500;
    }

    .preview-container img {
        max-width: 100%;
        max-height: 180px;
        object-fit: contain;
        border-radius: 10px;
    }

    .upload-actions {
        display: flex;
        justify-content: center;
        gap: 1rem;
    }

    .camera-btn {
        border-radius: 50px;
        padding: 0.5rem 1rem;
        font-weight: 500;
    }

    .submit-section {
        text-align: center;
        margin-top: 3rem;
    }

    .btn-submit-animated {
        position: relative;
        background: linear-gradient(135deg, #4CAF50, #FF9800);
        border: none;
        border-radius: 50px;
        padding: 1.5rem 3rem;
        color: white;
        font-size: 1.2rem;
        font-weight: 600;
        cursor: pointer;
        overflow: hidden;
        transition: all 0.3s ease;
        box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
    }

    .btn-submit-animated:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 35px rgba(76, 175, 80, 0.4);
    }

    .btn-content {
        position: relative;
        z-index: 2;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-overlay {
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        transition: left 0.5s;
    }

    .btn-submit-animated:hover .btn-overlay {
        left: 100%;
    }

    @media (max-width: 768px) {
        .upload-grid-2x2 {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        .upload-page-container {
            padding: 1rem;
        }

        .upload-header {
            padding: 2rem 1rem;
        }

        .upload-card {
            padding: 1.5rem;
        }
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // File input change listeners
        document.querySelectorAll('input[type="file"]').forEach(input => {
            input.addEventListener('change', function () {
                previewImage(this);
            });
        });

        // Image preview function
        function previewImage(input) {
            const previewId = 'preview' + input.id.replace('id_document', '');
            const previewContainer = document.getElementById(previewId);
            const uploadCard = input.closest('.upload-card');

            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    previewContainer.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
                    uploadCard.classList.add('has-image');
                };
                reader.readAsDataURL(input.files[0]);
            } else {
                // Reset preview
                previewContainer.innerHTML = `
                    <div class="preview-placeholder">
                        <i class="bi bi-image"></i>
                        <p>Click or drag image here</p>
                    </div>
                `;
                uploadCard.classList.remove('has-image');
            }
        }

        // Form submission handling
        document.querySelector('.upload-form').addEventListener('submit', function (e) {
            const submitBtn = document.querySelector('.btn-submit-animated');
            const hasImages = document.querySelectorAll('.upload-card.has-image').length > 0;

            if (!hasImages) {
                e.preventDefault();
                alert('Please upload at least one image before processing.');
                return;
            }

            // Add loading state
            submitBtn.innerHTML = `
                <div class="btn-content">
                    <i class="bi bi-cpu"></i>
                    <span>Processing...</span>
                </div>
            `;
            submitBtn.disabled = true;
        });
    });
</script>
{% endblock %}